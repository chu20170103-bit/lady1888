<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¦¹å¦¹è¨‚åƒ¹è¡¨è¨ˆç®—å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .content {
            padding: 25px;
        }

        .input-section {
            margin-bottom: 15px;
        }

        .input-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 8px;
            font-weight: 600;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .input-item {
            display: flex;
            flex-direction: column;
        }

        .input-item label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #34495e;
            font-size: 0.9em;
        }

        .input-item input {
            padding: 8px 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
            height: 40px;
            box-sizing: border-box;
            background: #fafbfc;
        }

        .input-item input:focus {
            outline: none;
            border-color: #4a90e2;
            background: white;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }



        .excel-formula-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .excel-formula-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }

        .formula-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .formula-text {
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #495057;
            flex: 1;
            word-break: break-all;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .copy-btn:active {
            background: #1e7e34;
        }

        .copy-status {
            font-size: 12px;
            color: #28a745;
            text-align: center;
            min-height: 16px;
        }

        .formula-display-inline {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .formula-text-inline {
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 3px;
            padding: 4px 6px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: #495057;
            word-break: break-all;
            flex: 1;
            height: 32px;
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        .copy-btn-inline {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s;
            white-space: nowrap;
        }

        .copy-btn-inline:hover {
            background: #218838;
        }

        .records-section {
            background: #f8fafb;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .records-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 1px solid #4a90e2;
            padding-bottom: 8px;
            font-weight: 600;
        }

        .save-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .save-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .save-btn:hover {
            background: #219a52;
            transform: translateY(-1px);
        }

        .clear-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .clear-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .records-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .record-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-info {
            flex: 1;
        }

        .record-title {
            font-weight: bold;
            color: #333;
            font-size: 13px;
        }

        .record-actions {
            display: flex;
            gap: 5px;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .no-records {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .location-buttons {
            display: flex;
            gap: 5px;
        }

        .location-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            color: white;
            transition: all 0.3s;
        }

        .location-btn {
            background: #95a5a6;
            color: white;
        }

        .location-btn.active {
            background: #4a90e2;
        }

        .location-btn:hover {
            opacity: 0.8;
        }

        .location-group {
            margin-bottom: 20px;
        }

        .records-four-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .location-section {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }

        .location-section h4 {
            color: #333;
            margin-bottom: 15px;
            padding: 8px 12px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
        }

        .location-two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .records-column {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
        }

        .records-column .records-list {
            max-height: 400px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .container {
                margin: 5px;
            }
            
            .content {
                padding: 15px;
            }
            
            .input-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .input-item label {
                font-size: 0.8em;
            }
            
            .records-four-columns {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .location-two-columns {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å¦¹å¦¹è¨‚åƒ¹è¡¨è¨ˆç®—å·¥å…·</h1>
            <p>å¿«é€Ÿè¨ˆç®—ä¸åŒæœå‹™æ–¹æ¡ˆçš„ç‡Ÿåˆ©åˆ†æ</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <h2>åŸºæœ¬è¨­å®š</h2>
                <div class="input-group">
                    <div class="input-item">
                        <label>åœ°å€é¸æ“‡</label>
                        <div class="location-buttons">
                            <button class="location-btn active" id="taoyuanBtn" onclick="selectLocation('taoyuan')">æ¡ƒåœ’</button>
                            <button class="location-btn" id="zhongliBtn" onclick="selectLocation('zhongli')">ä¸­å£¢</button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label for="sisterName">å¦¹å¦¹åç¨±</label>
                        <input type="text" id="sisterName" placeholder="è«‹è¼¸å…¥å¦¹å¦¹åç¨±">
                    </div>
                    <div class="input-item">
                        <label for="roomNumber">æˆ¿é–“è™Ÿ</label>
                        <input type="text" id="roomNumber" placeholder="è«‹è¼¸å…¥æˆ¿é–“è™Ÿ">
                    </div>
                    <div class="input-item">
                        <label for="economyFee">ç¶“æ¿Ÿè²» (100-300)</label>
                        <input type="number" id="economyFee" value="300" min="100" max="300" step="100">
                    </div>
                </div>
            </div>

            <div class="input-section">
                <h2>æœå‹™æ–¹æ¡ˆè¨­å®š</h2>
                <div class="input-group">
                    <div class="input-item">
                        <label for="service1Cost">40/1S å¦¹æ‹¿</label>
                        <input type="number" id="service1Cost" value="1000" step="100">
                    </div>
                    <div class="input-item">
                        <label for="service1Price">40/1S å›åƒ¹ (è‡ªå‹•è¨ˆç®—)</label>
                        <input type="number" id="service1Price" value="1900" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="input-item">
                        <label for="service1NetProfit">40/1S æ·¨åˆ©ç›®æ¨™</label>
                        <input type="number" id="service1NetProfit" value="600" step="100" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="input-item">
                        <label>Excelå…¬å¼</label>
                        <div class="formula-display-inline">
                            <div class="formula-text-inline" id="excelFormula">=IF(L175=60,"1300",IF(L175=90,"2300",IF(L175<=40,"1000",IF(L175>60,"1800"))))</div>
                            <button class="copy-btn-inline" onclick="copyExcelFormula()">ğŸ“‹</button>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-item">
                        <label for="service2Cost">60/1S å¦¹æ‹¿</label>
                        <input type="number" id="service2Cost" value="1300" step="100">
                    </div>
                    <div class="input-item">
                        <label for="service2Price">60/1S å›åƒ¹ (è‡ªå‹•è¨ˆç®—)</label>
                        <input type="number" id="service2Price" value="2400" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="input-item">
                        <label for="service2NetProfit">60/1S æ·¨åˆ©ç›®æ¨™</label>
                        <input type="number" id="service2NetProfit" value="800" step="100" readonly style="background-color: #f5f5f5;">
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-item">
                        <label for="service3Cost">60/2S å¦¹æ‹¿</label>
                        <input type="number" id="service3Cost" value="1800" step="100">
                    </div>
                    <div class="input-item">
                        <label for="service3Price">60/2S å›åƒ¹ (è‡ªå‹•è¨ˆç®—)</label>
                        <input type="number" id="service3Price" value="2900" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="input-item">
                        <label for="service3NetProfit">60/2S æ·¨åˆ©ç›®æ¨™</label>
                        <input type="number" id="service3NetProfit" value="800" step="100" readonly style="background-color: #f5f5f5;">
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-item">
                        <label for="service4Cost">90/2S å¦¹æ‹¿</label>
                        <input type="number" id="service4Cost" value="2300" step="100">
                    </div>
                    <div class="input-item">
                        <label for="service4Price">90/2S å›åƒ¹ (è‡ªå‹•è¨ˆç®—)</label>
                        <input type="number" id="service4Price" value="3600" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="input-item">
                        <label for="service4NetProfit">90/2S æ·¨åˆ©ç›®æ¨™</label>
                        <input type="number" id="service4NetProfit" value="1000" step="100" readonly style="background-color: #f5f5f5;">
                    </div>
                </div>
                
                <div class="save-section">
                    <button class="save-btn" onclick="saveRecord()">ğŸ’¾ å„²å­˜è¨˜éŒ„</button>
                    <button class="clear-btn" onclick="clearAllRecords()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„</button>
                </div>
            </div>

            <div class="records-section">
                <h3>è¨˜éŒ„ç®¡ç†</h3>
                <div class="records-four-columns">
                    <div class="location-section">
                        <h4>æ¡ƒåœ’</h4>
                        <div class="location-two-columns">
                            <div class="records-column">
                                <div class="records-list" id="taoyuanRecordsList1">
                                    <p class="no-records">æš«ç„¡è¨˜éŒ„</p>
                                </div>
                            </div>
                            <div class="records-column">
                                <div class="records-list" id="taoyuanRecordsList2">
                                    <p class="no-records">æš«ç„¡è¨˜éŒ„</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="location-section">
                        <h4>ä¸­å£¢</h4>
                        <div class="location-two-columns">
                            <div class="records-column">
                                <div class="records-list" id="zhongliRecordsList1">
                                    <p class="no-records">æš«ç„¡è¨˜éŒ„</p>
                                </div>
                            </div>
                            <div class="records-column">
                                <div class="records-list" id="zhongliRecordsList2">
                                    <p class="no-records">æš«ç„¡è¨˜éŒ„</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // æ›´æ–°å…¬å¼è¨­å®š
        function updateFormula() {
            // æ›´æ–°Excelå…¬å¼é¡¯ç¤º
            updateExcelFormula();
        }

        // æ›´æ–°Excelå…¬å¼é¡¯ç¤º
        function updateExcelFormula() {
            const service1Cost = document.getElementById('service1Cost').value; // 40/1S
            const service2Cost = document.getElementById('service2Cost').value; // 60/1S
            const service3Cost = document.getElementById('service3Cost').value; // 60/2S
            const service4Cost = document.getElementById('service4Cost').value; // 90/2S
            
            const excelFormula = `=IF(L175=60,"${service2Cost}",IF(L175=90,"${service4Cost}",IF(L175<=40,"${service1Cost}",IF(L175>60,"${service3Cost}"))))`;
            
            // æ›´æ–°å…¬å¼é¡¯ç¤º
            document.getElementById('excelFormula').textContent = excelFormula;
        }

        // è¤‡è£½Excelå…¬å¼åˆ°å‰ªè²¼ç°¿
        function copyExcelFormula() {
            const formulaText = document.getElementById('excelFormula').textContent;
            
            // ä½¿ç”¨ç¾ä»£ç€è¦½å™¨çš„Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(formulaText).then(function() {
                    showCopyStatus('âœ… å…¬å¼å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                }).catch(function(err) {
                    console.error('è¤‡è£½å¤±æ•—:', err);
                    fallbackCopyTextToClipboard(formulaText);
                });
            } else {
                // é™ç´šæ–¹æ¡ˆ
                fallbackCopyTextToClipboard(formulaText);
            }
        }

        // é™ç´šè¤‡è£½æ–¹æ¡ˆ
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyStatus('âœ… å…¬å¼å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                } else {
                    showCopyStatus('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
                }
            } catch (err) {
                console.error('è¤‡è£½å¤±æ•—:', err);
                showCopyStatus('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            }
            
            document.body.removeChild(textArea);
        }

        // é¡¯ç¤ºè¤‡è£½ç‹€æ…‹
        function showCopyStatus(message) {
            // å‰µå»ºè‡¨æ™‚ç‹€æ…‹æç¤º
            const statusDiv = document.createElement('div');
            statusDiv.textContent = message;
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 10px 15px;
                border-radius: 4px;
                font-size: 14px;
                z-index: 1000;
            `;
            document.body.appendChild(statusDiv);
            
            setTimeout(function() {
                document.body.removeChild(statusDiv);
            }, 3000);
        }

        // è‡ªå‹•è¨ˆç®—æˆæœ¬å‡½æ•¸ - æ ¹æ“šå‹•æ…‹å…¬å¼é‚è¼¯
        function autoCalculateCost(serviceNumber) {
            const timeInput = document.getElementById(`service${serviceNumber}Time`);
            const costInput = document.getElementById(`service${serviceNumber}Cost`);
            
            const time = parseInt(timeInput.value) || 0;
            let cost = 0;
            
            // ç²å–å‹•æ…‹å…¬å¼è¨­å®šå€¼
            const formula60 = parseFloat(document.getElementById('formula60').value) || 1300;
            const formula90 = parseFloat(document.getElementById('formula90').value) || 2300;
            const formula40 = parseFloat(document.getElementById('formula40').value) || 1000;
            const formulaOver60 = parseFloat(document.getElementById('formulaOver60').value) || 1800;
            
            // å‹•æ…‹å…¬å¼é‚è¼¯: =IF(L175=60,"formula60",IF(L175=90,"formula90",IF(L175<=40,"formula40",IF(L175>60,"formulaOver60"))))
            if (time === 60) {
                cost = formula60;
            } else if (time === 90) {
                cost = formula90;
            } else if (time <= 40) {
                cost = formula40;
            } else if (time > 60) {
                cost = formulaOver60;
            }
            
            costInput.value = cost;
            
        }


        // è¨˜éŒ„ç®¡ç†åŠŸèƒ½
        let records = JSON.parse(localStorage.getItem('sisterRecords')) || [];
        let currentLocation = 'taoyuan'; // é è¨­æ¡ƒåœ’

        // é è¨­è¨˜éŒ„æ•¸æ“š
        const defaultRecords = [
            // ä¸­å£¢è¨˜éŒ„
            { id: 1, location: 'zhongli', roomNumber: '201', services: { service1: { cost: 1000 }, service2: { cost: 1200 }, service3: { cost: 1700 } }, economyFee: 300 },
            { id: 2, location: 'zhongli', roomNumber: '202', services: { service1: { cost: 0 }, service2: { cost: 0 }, service3: { cost: 0 } }, economyFee: 0 },
            { id: 3, location: 'zhongli', roomNumber: '205', services: { service1: { cost: 0 }, service2: { cost: 0 }, service3: { cost: 0 } }, economyFee: 0 },
            { id: 4, location: 'zhongli', roomNumber: '206', services: { service1: { cost: 1100 }, service2: { cost: 1400 }, service3: { cost: 1900 } }, economyFee: 300 },
            { id: 5, location: 'zhongli', roomNumber: '207', services: { service1: { cost: 1000 }, service2: { cost: 1200 }, service3: { cost: 1700 } }, economyFee: 300 },
            { id: 6, location: 'zhongli', roomNumber: '208', services: { service1: { cost: 1100 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 7, location: 'zhongli', roomNumber: '209', services: { service1: { cost: 1000 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 8, location: 'zhongli', roomNumber: '306', services: { service1: { cost: 1100 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 9, location: 'zhongli', roomNumber: '307', services: { service1: { cost: 0 }, service2: { cost: 0 }, service3: { cost: 0 } }, economyFee: 0 },
            { id: 10, location: 'zhongli', roomNumber: '308', services: { service1: { cost: 1100 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 11, location: 'zhongli', roomNumber: '309', services: { service1: { cost: 1100 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            
            // æ¡ƒåœ’è¨˜éŒ„
            { id: 12, location: 'taoyuan', roomNumber: '701', services: { service1: { cost: 1100 }, service2: { cost: 1400 }, service3: { cost: 1900 } }, economyFee: 300 },
            { id: 13, location: 'taoyuan', roomNumber: '702', services: { service1: { cost: 1100 }, service2: { cost: 1400 }, service3: { cost: 1900 } }, economyFee: 300 },
            { id: 14, location: 'taoyuan', roomNumber: '703', services: { service1: { cost: 1100 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 15, location: 'taoyuan', roomNumber: '705', services: { service1: { cost: 1000 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 16, location: 'taoyuan', roomNumber: '707', services: { service1: { cost: 1000 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 17, location: 'taoyuan', roomNumber: '708', services: { service1: { cost: 0 }, service2: { cost: 0 }, service3: { cost: 0 } }, economyFee: 0 },
            { id: 18, location: 'taoyuan', roomNumber: '709', services: { service1: { cost: 1100 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 19, location: 'taoyuan', roomNumber: '710', services: { service1: { cost: 1200 }, service2: { cost: 1500 }, service3: { cost: 2000 } }, economyFee: 300 },
            { id: 20, location: 'taoyuan', roomNumber: '711', services: { service1: { cost: 1000 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 },
            { id: 21, location: 'taoyuan', roomNumber: '715', services: { service1: { cost: 1000 }, service2: { cost: 1300 }, service3: { cost: 1800 } }, economyFee: 300 }
        ];

        // åˆå§‹åŒ–é è¨­è¨˜éŒ„ï¼ˆå¦‚æœæ²’æœ‰ç¾æœ‰è¨˜éŒ„ï¼‰
        if (records.length === 0) {
            records = defaultRecords;
            localStorage.setItem('sisterRecords', JSON.stringify(records));
        }
        
        // å¼·åˆ¶è¼‰å…¥é è¨­è¨˜éŒ„ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
        records = defaultRecords;
        localStorage.setItem('sisterRecords', JSON.stringify(records));

        // é¸æ“‡åœ°å€
        function selectLocation(location) {
            currentLocation = location;
            const taoyuanBtn = document.getElementById('taoyuanBtn');
            const zhongliBtn = document.getElementById('zhongliBtn');
            
            if (location === 'taoyuan') {
                taoyuanBtn.classList.add('active');
                zhongliBtn.classList.remove('active');
            } else {
                zhongliBtn.classList.add('active');
                taoyuanBtn.classList.remove('active');
            }
        }

        // å„²å­˜è¨˜éŒ„
        function saveRecord() {
            const sisterName = document.getElementById('sisterName').value;
            const roomNumber = document.getElementById('roomNumber').value;
            const economyFee = document.getElementById('economyFee').value;
            
            const service1Cost = document.getElementById('service1Cost').value;
            const service1Price = document.getElementById('service1Price').value;
            const service1NetProfit = document.getElementById('service1NetProfit').value;
            
            const service2Cost = document.getElementById('service2Cost').value;
            const service2Price = document.getElementById('service2Price').value;
            const service2NetProfit = document.getElementById('service2NetProfit').value;
            
            const service3Cost = document.getElementById('service3Cost').value;
            const service3Price = document.getElementById('service3Price').value;
            const service3NetProfit = document.getElementById('service3NetProfit').value;
            
            const service4Cost = document.getElementById('service4Cost').value;
            const service4Price = document.getElementById('service4Price').value;
            const service4NetProfit = document.getElementById('service4NetProfit').value;

            if (!roomNumber.trim()) {
                alert('è«‹è¼¸å…¥æˆ¿é–“è™Ÿ');
                return;
            }

            const record = {
                id: Date.now(),
                timestamp: new Date().toLocaleString('zh-TW'),
                location: currentLocation,
                sisterName: sisterName,
                roomNumber: roomNumber,
                economyFee: economyFee,
                services: {
                    service1: { cost: service1Cost, price: service1Price, netProfit: service1NetProfit },
                    service2: { cost: service2Cost, price: service2Price, netProfit: service2NetProfit },
                    service3: { cost: service3Cost, price: service3Price, netProfit: service3NetProfit },
                    service4: { cost: service4Cost, price: service4Price, netProfit: service4NetProfit }
                }
            };

            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒåœ°å€å’Œæˆ¿é–“è™Ÿçš„è¨˜éŒ„
            const existingIndex = records.findIndex(r => r.location === currentLocation && r.roomNumber === roomNumber);
            
            if (existingIndex !== -1) {
                // å–ä»£ç¾æœ‰è¨˜éŒ„
                records[existingIndex] = record;
                alert('è¨˜éŒ„å·²æ›´æ–°ï¼');
            } else {
                // æ–°å¢è¨˜éŒ„
                records.unshift(record);
                alert('è¨˜éŒ„å·²å„²å­˜ï¼');
            }
            
            localStorage.setItem('sisterRecords', JSON.stringify(records));
            displayRecords();
        }

        // é¡¯ç¤ºè¨˜éŒ„
        function displayRecords() {
            const taoyuanRecordsList1 = document.getElementById('taoyuanRecordsList1');
            const taoyuanRecordsList2 = document.getElementById('taoyuanRecordsList2');
            const zhongliRecordsList1 = document.getElementById('zhongliRecordsList1');
            const zhongliRecordsList2 = document.getElementById('zhongliRecordsList2');
            
            // åˆ†çµ„é¡¯ç¤ºï¼šæ¡ƒåœ’å’Œä¸­å£¢
            const taoyuanRecords = records.filter(record => record.location === 'taoyuan');
            const zhongliRecords = records.filter(record => record.location === 'zhongli');

            // é¡¯ç¤ºæ¡ƒåœ’è¨˜éŒ„ï¼ˆåˆ†å…©æ¬„ï¼‰
            if (taoyuanRecords.length > 0) {
                const midPoint = Math.ceil(taoyuanRecords.length / 2);
                const taoyuanRecords1 = taoyuanRecords.slice(0, midPoint);
                const taoyuanRecords2 = taoyuanRecords.slice(midPoint);
                
                taoyuanRecordsList1.innerHTML = taoyuanRecords1.map(record => createRecordItem(record)).join('');
                taoyuanRecordsList2.innerHTML = taoyuanRecords2.map(record => createRecordItem(record)).join('');
            } else {
                taoyuanRecordsList1.innerHTML = '<p class="no-records">æš«ç„¡è¨˜éŒ„</p>';
                taoyuanRecordsList2.innerHTML = '<p class="no-records">æš«ç„¡è¨˜éŒ„</p>';
            }
            
            // é¡¯ç¤ºä¸­å£¢è¨˜éŒ„ï¼ˆåˆ†å…©æ¬„ï¼‰
            if (zhongliRecords.length > 0) {
                const midPoint = Math.ceil(zhongliRecords.length / 2);
                const zhongliRecords1 = zhongliRecords.slice(0, midPoint);
                const zhongliRecords2 = zhongliRecords.slice(midPoint);
                
                zhongliRecordsList1.innerHTML = zhongliRecords1.map(record => createRecordItem(record)).join('');
                zhongliRecordsList2.innerHTML = zhongliRecords2.map(record => createRecordItem(record)).join('');
            } else {
                zhongliRecordsList1.innerHTML = '<p class="no-records">æš«ç„¡è¨˜éŒ„</p>';
                zhongliRecordsList2.innerHTML = '<p class="no-records">æš«ç„¡è¨˜éŒ„</p>';
            }
        }

        // å‰µå»ºè¨˜éŒ„é …ç›®
        function createRecordItem(record) {
            const cost1 = Math.floor((record.services.service1.cost || 0) / 100);
            const cost2 = Math.floor((record.services.service2.cost || 0) / 100);
            const cost3 = Math.floor((record.services.service3.cost || 0) / 100);
            const economy = Math.floor((record.economyFee || 0) / 100);
            
            // å¦‚æœæ‰€æœ‰æˆæœ¬éƒ½æ˜¯0ï¼Œåªé¡¯ç¤ºæˆ¿é–“è™Ÿ
            if (cost1 === 0 && cost2 === 0 && cost3 === 0 && economy === 0) {
                return `
                    <div class="record-item">
                        <div class="record-info">
                            <div class="record-title">${record.roomNumber}</div>
                        </div>
                        <div class="record-actions">
                            <button class="delete-btn" onclick="deleteRecord(${record.id})">åˆª</button>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="record-item">
                    <div class="record-info">
                        <div class="record-title">${record.roomNumber}ã€Œ${cost1}-${cost2}-${cost3}+${economy}ã€</div>
                    </div>
                    <div class="record-actions">
                        <button class="delete-btn" onclick="deleteRecord(${record.id})">åˆª</button>
                    </div>
                </div>
            `;
        }

        // åˆªé™¤è¨˜éŒ„
        function deleteRecord(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) {
                records = records.filter(record => record.id !== id);
                localStorage.setItem('sisterRecords', JSON.stringify(records));
                displayRecords();
            }
        }

        // æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„
        function clearAllRecords() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                records = [];
                localStorage.removeItem('sisterRecords');
                displayRecords();
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¨ˆç®—ä¸€æ¬¡
        window.onload = function() {
            // åˆå§‹åŒ–æ‰€æœ‰å›åƒ¹
            autoCalculatePrice(1);
            autoCalculatePrice(2);
            autoCalculatePrice(3);
            autoCalculatePrice(4);
            
            // åˆå§‹åŒ–Excelå…¬å¼é¡¯ç¤º
            updateExcelFormula();
            
            // é¡¯ç¤ºç¾æœ‰è¨˜éŒ„
            displayRecords();
        };

        // è‡ªå‹•è¨ˆç®—å›åƒ¹
        function autoCalculatePrice(serviceNumber) {
            const costInput = document.getElementById(`service${serviceNumber}Cost`);
            const netProfitInput = document.getElementById(`service${serviceNumber}NetProfit`);
            const priceInput = document.getElementById(`service${serviceNumber}Price`);
            const economyFeeInput = document.getElementById('economyFee');
            
            const cost = parseFloat(costInput.value) || 0;
            const netProfit = parseFloat(netProfitInput.value) || 0;
            const economyFee = parseFloat(economyFeeInput.value) || 0;
            
            // å›åƒ¹ = å¦¹æ‹¿ + ç¶“æ¿Ÿè²» + æ·¨åˆ©ç›®æ¨™
            const price = cost + economyFee + netProfit;
            priceInput.value = price;
        }

        // ç•¶ä»»ä½•è¼¸å…¥å€¼æ”¹è®Šæ™‚è‡ªå‹•é‡æ–°è¨ˆç®—
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'INPUT') {
                // å¦‚æœæ˜¯æœå‹™æ–¹æ¡ˆçš„æˆæœ¬æ¬„ä½ï¼Œæ›´æ–°Excelå…¬å¼
                if (e.target.id.includes('service') && e.target.id.includes('Cost')) {
                    updateExcelFormula();
                }
                
                // å¦‚æœæ˜¯å¦¹æ‹¿æˆ–ç¶“æ¿Ÿè²»æ”¹è®Šï¼Œè‡ªå‹•è¨ˆç®—å›åƒ¹
                if (e.target.id.includes('service') && e.target.id.includes('Cost')) {
                    const serviceNumber = e.target.id.match(/\d+/)[0];
                    autoCalculatePrice(serviceNumber);
                } else if (e.target.id === 'economyFee') {
                    // ç¶“æ¿Ÿè²»æ”¹è®Šæ™‚ï¼Œé‡æ–°è¨ˆç®—æ‰€æœ‰å›åƒ¹
                    autoCalculatePrice(1);
                    autoCalculatePrice(2);
                    autoCalculatePrice(3);
                    autoCalculatePrice(4);
                }
            }
        });
    </script>
</body>
</html>
